<!DOCTYPE html>
<!-- cse6242 -->

<!-- run: http-server & -->

<head>
  <style>    
    /* Define css rules here */
    body {
      font-family: sans-serif;
    }

    svg {
      background-color: black;
    }
  </style>
<title>Wildlife Trafficking Incidents per Species (2015 to 2023)</title>
</head>

<body>

  <script src="lib/d3/d3.min.js"></script>
  <script src="lib/d3-dsv/d3-dsv.min.js"></script>
  <script src="lib/d3-fetch/d3-fetch.min.js"></script>


  <script>
     // Define the dimensions and margins for the graph
    var margin = { top: 40, right: 30, bottom: 50, left: 100 };
    var width = 900 - margin.left - margin.right;
    var height = 370 - margin.top - margin.bottom; // Height increased for better visibility

    // Append svg element to the body of the page
    var svg = d3.select("body").append("svg")
      .attr("id", "svg1")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom);

    // Get the data and filter for top 5 most trafficked species
    var pathToCsv = "q3.csv"; // Path to csv

    d3.dsv(",", pathToCsv, function(d) {
      return {
        species: d.species,
        count: +d.count // Parse count to integer
      };
    }).then(function(data) {
      console.log(data);

      // Filter and sort data for the top 5 species
      data = data.sort((a, b) => d3.descending(a.count, b.count)).slice(0, 5);

      // Set up the scales: X is linear (count) and Y is band (species)
      var xScale = d3.scaleLinear()
        .domain([0, d3.max(data, d => d.count)]) // Linear scale for count
        .range([0, width]);

      var yScale = d3.scaleBand()
        .domain(data.map(d => d.species)) // Categorical scale for species
        .range([0, height])
        .padding(0.1);

      var colorScale = d3.scaleOrdinal(d3.schemeCategory10);

      var containerGroup = svg.append("g")
        .attr("id", "container")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var barsGroup = containerGroup.append("g")
          .attr("id", "bars");

      // Add bars to the svg - create new elements based on your data
      barsGroup.selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr("class", "bar")
        .attr("y", d => yScale(d.species))
        .attr("x", 0)
        .attr("width", d => xScale(d.count))
        .attr("height", yScale.bandwidth())
        .attr("fill", (d, i) => colorScale(i));

      // Add the X Axis (Count)
      containerGroup.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(xScale).ticks(5).tickFormat(d3.format("d")))
          .attr("id", "x_axis")
          .attr("fill", "white")
          .attr("stroke", "white");

      // Add the X Axis label (Count)
      containerGroup.append("text")
          .attr("x", width / 2)
          .attr("y", height + margin.bottom - 10)
          .attr("id", "x_axis_label")
          .style("font-size", "14px")
          .style("fill", "white")
          .text("Count");

      // Add the Y Axis (Species)
      containerGroup.append("g")
        .call(d3.axisLeft(yScale))
        .attr("id", "y_axis")
        .attr("fill", "white")
        .attr("stroke", "white");

      // Add the Y Axis label (Species)
      containerGroup.append("text")
          .attr("transform", "rotate(-90)")
          .attr("x", -height / 2)
          .attr("y", -margin.left + 20)
          .attr("id", "y_axis_label")
          .style("font-size", "14px")
          .style("fill", "white")
          .text("Species");

      // Add GT username
      containerGroup.append("text")
          .attr("x", width + margin.right - 5)
          .attr("y", height + margin.bottom - 5)
          .attr("text-anchor", "end")
          .attr("id", "credit")
          .style("font-size", "12px")
          .style("fill", "white")
          .text("adieck3");

      // Add Title
      containerGroup.append("text")
          .attr("x", width / 2)
          .attr("y", -margin.top / 2)
          .attr("text-anchor", "middle")
          .attr("id", "title")
          .style("font-size", "16px")
          .style("font-weight", "bold")
          .style("fill", "white")
          .text("Wildlife Trafficking Incidents per Species (2015 to 2023)");

    }).catch(function (error) {
      console.log(error);
    });

  </script>
</body>
